<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ben Harrap">
<meta name="dcterms.date" content="2024-01-19">

<title>Ben Harrap - Making a custom RStudio theme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&amp;family=Nunito:ital,wght@0,200..1000;1,200..1000&amp;family=Source+Sans+3:ital,wght@0,200..900;1,200..900&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ben Harrap</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../post.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Making a custom RStudio theme</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">design</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ben Harrap </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Today was going to be a productive day, I was going to get lots of work done, but then I had the thought “wouldn’t it be cool if I could make my own RStudio theme?” And now it’s 5pm and I definitely achieved something today but not what I set out to do. Making my own theme sure was fun though!</p>
<p>My <code>noodle</code> theme is available on <a href="https://github.com/benharrap/rsthemes">github</a> if you want to use it yourself. I’m solidly in my pastel pink era at the moment so I created the theme with that in mind. If you’re wondering why it’s called noodle, I was wearing a pastel pink t-shirt with a greyhound on it today (<a href="https://everpress.com/i-can-fly">this one if you must know</a>) and noodle is a silly nickname for greyhounds. Below are a couple of previews of what the theme looks like.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rcode-preview.PNG" class="img-fluid figure-img"></p>
<figcaption>The noodle theme applied to R code</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rmarkdown-preview.PNG" class="img-fluid figure-img"></p>
<figcaption>The noodle theme applied to an RMarkdown document</figcaption>
</figure>
</div>
<p>Most of today was a lot of trial and error, so I figured I’d collate what I learned into a blog post to hopefully save you some time. If you’re interested in making your own theme, read on!</p>
<section id="protip" class="level2">
<h2 class="anchored" data-anchor-id="protip">Protip</h2>
<p>While the following tips will help you get started, RStudio is rendered like a website, so you can right-click and click on inspect element to have a look at the thing you want to modify. Two useful ways to identify the thing you want to change are to look at the class it has - the element will usually begin something like <code>&lt;div class="ace_content"&gt;</code>, so you’d search the <code>rstheme</code> file for that class. Alternatively, you could look for the colour which will usually be specified as a hex code (<code>#f7dcf0</code>) or as an rgb or rgba value <code>rgba(0, 184, 25, 0.5)</code>.</p>
</section>
<section id="step-1---copy-an-existing-.rstheme-file" class="level2">
<h2 class="anchored" data-anchor-id="step-1---copy-an-existing-.rstheme-file">Step 1 - copy an existing <code>.rstheme</code> file</h2>
<p>There’s no point writing this all from scratch. We’re going to be good little scientists and Frankenstein our theme together.</p>
<p>To do this, find where RStudio is installed on your machine and navigate to the following directory <code>.\RStudio\resources\app\resources\themes</code>. You’ll see all the default <code>.rstheme</code> files - copy one of these to a location that’s not in the RStudio folder (on Windows it doesn’t like you editing files in this folder). Alternatively you can just download <code>noodle.rstheme</code> from my github and use that as your basis. The difference between my file and the default ones is I had a go at grouping the arguments into colours for not-text, colours for text, and other bits.</p>
<p>Once you’ve got a copy of an existing theme, open it in RStudio. Initially RStudio won’t know what the hell it is, so using the language drop-down in the corner of the source pane, update the language to CSS. This is useful because RStudio will preview what the colours in your file look like.</p>
</section>
<section id="step-2---start-testing-out-different-colours" class="level2">
<h2 class="anchored" data-anchor-id="step-2---start-testing-out-different-colours">Step 2 - start testing out different colours</h2>
<p>This is where the fun begins. There’s lots of different aspects to RStudio that you can control. I was using the guidance from <a href="https://docs.posit.co/ide/user/ide/guide/ui/appearance.html#creating-an-rstheme">Posit’s website</a>, but there was a lot of back and forth and testing and being confused. I’ve embedded the webpage here so you can scroll through the list of selectors to see what Posit say about them.</p>
<iframe width="100%" height="400" src="https://docs.posit.co/ide/user/ide/guide/ui/appearance.html#creating-an-rstheme" frameborder="0">
</iframe>
<p>It wouldn’t be <code>css</code> if it wasn’t confusing though, so I’ll step through some of the different options. I’ll go through changing the colours of not-text first, then is-text second. Delineating these things makes sense to me, you’ll see it in <code>noodle.rstheme</code> where I define <code>css</code> for the editor theme twice, once for the background colour and once for the default text colour.</p>
<p>Before you press on you’ll also want to have either a colour scheme handy or some kind of colour picking tool so you can get the hex codes.</p>
<section id="background-colour" class="level3">
<h3 class="anchored" data-anchor-id="background-colour">Background colour</h3>
<pre><code>.ace_editor, .ace_editor_theme .profvis-flamegraph, .ace_editor_theme {
  background-color: #F7DCF0
}</code></pre>
<p>This changes the background colour of RStudio’s panes, except for the terminal tab. It also doesn’t change the colour of the ‘gutter’, which is the part of the source pane where the line numbers appear.</p>
</section>
<section id="gutter-colour" class="level3">
<h3 class="anchored" data-anchor-id="gutter-colour">Gutter colour</h3>
<pre><code>.ace_gutter {
  background: #F7DCF0
}</code></pre>
<p>This will change the background colour of the ‘gutter’. I made it the same colour as the main part of the source pane but you can do whatever you like.</p>
</section>
<section id="terminal-colour" class="level3">
<h3 class="anchored" data-anchor-id="terminal-colour">Terminal colour</h3>
<pre><code>.terminal {
  background-color: #F7DCF0;
  color: #000000;
}</code></pre>
<p>In the default <code>rstheme</code> files there’s a bunch of other options in the <code>terminal</code> argument. Don’t know what they do, and I don’t really use terminal much either, I just wanted it all to be consistently coloured. <code>background-color</code> changes the background and <code>color</code> changes the cursor colour.</p>
</section>
<section id="cursor-colour" class="level3">
<h3 class="anchored" data-anchor-id="cursor-colour">Cursor colour</h3>
<pre><code>.ace_cursor {
  color: #000000
}</code></pre>
<p>This changes the colour of the cursor (the little bar indicating where you’re typing).</p>
</section>
<section id="selection-colour" class="level3">
<h3 class="anchored" data-anchor-id="selection-colour">Selection colour</h3>
<pre><code>.ace_marker-layer .ace_selection {
  background: #82C28273
}</code></pre>
<p>This is one of my favourites. When you select code it’ll have this colour as the background. <span style="background-color: #82C28273">In the example it would highlight code in this colour!</span></p>
</section>
<section id="bracket-highlights" class="level3">
<h3 class="anchored" data-anchor-id="bracket-highlights">Bracket highlights</h3>
<pre><code>.ace_bracket {
  margin: 0 !important;
  border: 0 !important;
  background-color: rgba(0, 184, 25, 0.5);
}</code></pre>
<p>This is my other favourite! When your code has brackets, putting the cursor one of a pair of brackets will highlight them both so you can see where the bracketed code starts and end. Super useful when you’re working with bracketception. Some of the default themes weren’t obvious enough for me so I made it pretty clear with this green. Note in this instance I used <code>rgba</code> rather than a colour hex code - the last input (0.5 in this case) defines the transparency. You can define transparency with hex codes too but this works fine.</p>
</section>
<section id="code-chunks" class="level3">
<h3 class="anchored" data-anchor-id="code-chunks">Code chunks</h3>
<pre><code>.ace_marker-layer .ace_foreign_line {
  position: absolute;
  z-index: -1;
  background-color: #f6d1ed;
}</code></pre>
<p>This one sets the colour of code chunks.</p>
</section>
<section id="default-text" class="level3">
<h3 class="anchored" data-anchor-id="default-text">Default text</h3>
<pre><code>.ace_editor, .ace_editor_theme .profvis-flamegraph, .ace_editor_theme {
  color: #00006B
}</code></pre>
<p>This is the colour the majority of the text in your editor will be, basically any text that isn’t one of the special types defined later.</p>
</section>
<section id="gutter-text" class="level3">
<h3 class="anchored" data-anchor-id="gutter-text">Gutter text</h3>
<pre><code>.ace_gutter {
  color: #333
}</code></pre>
<p>Remember the gutter? Well this is how you define what colour the line numbers will be.</p>
</section>
<section id="keywords" class="level3">
<h3 class="anchored" data-anchor-id="keywords">Keywords</h3>
<pre><code>.ace_keyword {
  color: #9D00FF !important;
}</code></pre>
<p>Special words like <code>if</code> and <code>function</code> will be this colour</p>
</section>
<section id="metadata" class="level3">
<h3 class="anchored" data-anchor-id="metadata">Metadata</h3>
<pre><code>.ace_meta,
.ace_support.ace_constant.ace_property-value {
  color: #6585ae
}</code></pre>
<p>Text in document headers will be this colour, like titles, YAML and the like.</p>
</section>
<section id="truefalse-and-italics" class="level3">
<h3 class="anchored" data-anchor-id="truefalse-and-italics">TRUE/FALSE and italics</h3>
<pre><code>.ace_constant.ace_language {
  color: #D29380
}</code></pre>
<p>This sets the colour of the words <code>TRUE</code> and <code>FALSE</code>, plus any italicised text in markdown docs. You can specify a more general argument than this by just using <code>.ace_constant</code> on its own, but I like to be able to easily tell the difference between bolded and italicised text when I’m writing RMarkdown documents.</p>
</section>
<section id="numeric-constants-and-bold-text" class="level3">
<h3 class="anchored" data-anchor-id="numeric-constants-and-bold-text">Numeric constants and bold text</h3>
<pre><code>.ace_constant.ace_numeric {
  color: #FF8080
}</code></pre>
<p>This sets the colour of numeric constants, for example the <code>8</code> in <code>mutate(x = 8)</code> would be <span style="background-color: #FF8080">this colour</span>. It’s also the color that bolded text in markdown documents will be.</p>
</section>
<section id="strings" class="level3">
<h3 class="anchored" data-anchor-id="strings">Strings</h3>
<pre><code>.ace_string {
  color: #009E18
}</code></pre>
<p>This sets the colour of strings.</p>
</section>
<section id="comments" class="level3">
<h3 class="anchored" data-anchor-id="comments">Comments</h3>
<pre><code>.ace_comment {
  color: #5E5E5E
}</code></pre>
<p>This sets the colour of comments (you better be writing comments!).</p>
</section>
<section id="rainbow-indent-lines" class="level3">
<h3 class="anchored" data-anchor-id="rainbow-indent-lines">Rainbow indent lines</h3>
<pre><code>.rstudio_rainbow_indent_guides .ace_line .ace_indent-guide:nth-child(2n+1){
    background: linear-gradient(to left, #f38989 1px, transparent 1px, transparent);
}
.rstudio_rainbow_indent_guides .ace_line .ace_indent-guide:nth-child(2n+2){
    background: linear-gradient(to left, #78c1a3 1px, transparent 1px, transparent);
}</code></pre>
<p>If you don’t know what indents are, you can find them by going through the menus <code>Tools -&gt; Global Options -&gt; Code -&gt; Display -&gt; Indentation guidelines</code>. You can have a bit of fun changing these. The two things you need to pay attention to are the colours (obviously) and the <code>nth-child(2n+1)</code> statements. I’m making an assumption here, but I think the number before <code>n</code> indicates how many colours there are in your set of rainbow indent colours, and the number following the <code>+</code> indicate the ordering of the colours. So in the above example, <span style="background-color: #f38989">#f38989</span> comes first and <span style="background-color: #78c1a3">#78c1a3</span> comes second and repeats for however many indents you have.</p>
</section>
<section id="rainbow-indent-fills" class="level3">
<h3 class="anchored" data-anchor-id="rainbow-indent-fills">Rainbow indent fills</h3>
<pre><code>.rstudio_rainbow_indent_fills .ace_line .ace_indent-guide:nth-child(2n+1){
    background: linear-gradient(to left, #f3898977 1px, #f3898977 1px, #f3898977);
}
.rstudio_rainbow_indent_fills .ace_line .ace_indent-guide:nth-child(2n+2){
    background: linear-gradient(to left, #78c1a377 1px, #78c1a377 1px, #78c1a377);
}</code></pre>
<p>These are similar to the indent lines, except it fills the indents in blocks (vertically). The main difference here is the addition of two numbers at the end of the hex code, controlling the transparency. I’d suggest keeping the transparency, it looks weird with block colours!</p>
</section>
<section id="grey-line-indents" class="level3">
<h3 class="anchored" data-anchor-id="grey-line-indents">Grey line indents</h3>
<p>This the final thing I’ll mention, and I think the most interesting!</p>
<pre><code>.ace_indent-guide {
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAANSURBVBhXY9jYWl4GAAW8AiRaxbuHAAAAAElFTkSuQmCC") right repeat-y
}</code></pre>
<p>It turns out that the grey line indents are actually tiny base64 images, so if you want to modify the colour to make them more visible you’ll need to create a new 1-pixel image. When I was creating my theme, the default colour of the theme I’d Frankensteined was too light to clearly see, so I ended up making a darker pixel for better contrast. I just made a 1-pixel image in paint and uploaded it to https://www.base64-image.de/ to get the base64 code used here.</p>
</section>
</section>
<section id="step-3---add-your-theme-to-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="step-3---add-your-theme-to-rstudio">Step 3 - add your theme to RStudio</h2>
<p>There’s heaps more settings you can change, but hopefully the ones above are enough to get you going. Before you add your theme to RStudio there’s one final thing you’ll need to change! At the top of the file you’ll see two lines of code:</p>
<pre><code>/* rs-theme-name: Noodle */
/* rs-theme-is-dark: FALSE */</code></pre>
<p>The first one is where you give it a name and the second is where you specify if you want RStudio’s broader theme to be light (FALSE) or dark (TRUE). Once you’ve changed this last bit, save the file. In order to add your theme to RStudio, navigate to the themes menu (<code>Tools -&gt; Global Options -&gt; Appearance</code>) and click the <code>Add</code> button. Navigate to wherever you’ve been keeping your <code>.rstheme</code> file and select it. It’ll appear in the list of themes, so just select it and click apply. Hey presto!</p>
</section>
<section id="step-4---tinkering" class="level2">
<h2 class="anchored" data-anchor-id="step-4---tinkering">Step 4 - tinkering</h2>
<p>If you’re anything like me you’ll spend several hours tinkering with colours to see what the options do and what your colour palette looks like together. Since you can’t edit the theme file while it’s loaded into RStudio, make the edits to the <code>.rstheme</code> file you created that <em>wasn’t</em> in the RStudio folder. When you’re ready to test your updates, head back to the <code>Appearance</code> menu, change the theme to something else, remove your theme by highlighting it and clicking the <code>Remove</code> button, then add it again.</p>
<p>There’s probably a smarter way of doing it but it worked for me. I hope you’ve found this useful! If I’ve made a mistake or misunderstood something in this blog post, be a good scientist and (kindly) let me know.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>